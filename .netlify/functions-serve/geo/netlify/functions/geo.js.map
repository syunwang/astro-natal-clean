{
  "version": 3,
  "sources": ["file:///D:/astro-natal-clean/netlify/functions/geo.js"],
  "sourceRoot": "C:/Users/ADMIN/AppData/Local/Temp/tmp-37920-nxtb8VLYawoP",
  "sourcesContent": ["const DEFAULT_GEO_URL =\n  process.env.FREEASTRO_GEO_URL || \"https://nominatim.openstreetmap.org/search\";\n\nconst json = (statusCode, data) => ({\n  statusCode,\n  headers: {\n    \"Content-Type\": \"application/json; charset=utf-8\",\n    \"Access-Control-Allow-Origin\": \"*\",\n    \"Access-Control-Allow-Headers\": \"Content-Type, Authorization\",\n    \"Access-Control-Allow-Methods\": \"GET, OPTIONS\"\n  },\n  body: JSON.stringify(data),\n});\n\nexports.handler = async (event) => {\n  try {\n    if (event.httpMethod === \"OPTIONS\") return json(204, {});\n    if (event.httpMethod !== \"GET\") return json(405, { message: \"Method Not Allowed\" });\n\n    const place = event.queryStringParameters?.place || \"\";\n    if (!place) return json(400, { message: \"Missing query ?place=\" });\n\n    const url = new URL(DEFAULT_GEO_URL);\n    url.searchParams.set(\"q\", place);\n    url.searchParams.set(\"format\", \"json\");\n    url.searchParams.set(\"limit\", \"1\");\n\n    const res = await fetch(url.toString(), {\n      headers: { \"User-Agent\": \"astro-natal-clean/1.0 (Netlify Function)\" },\n    });\n\n    if (!res.ok) {\n      const txt = await res.text();\n      return json(res.status, { message: \"Upstream error\", raw: txt });\n    }\n\n    const arr = await res.json();\n    if (!Array.isArray(arr) || arr.length === 0) {\n      return json(404, { message: \"No result\", place });\n    }\n\n    const first = arr[0];\n    return json(200, {\n      lat: Number(first.lat),\n      lon: Number(first.lon),\n      display_name: first.display_name,\n      raw: first,\n    });\n  } catch (err) {\n    return json(500, { message: \"Unexpected error\", error: String(err?.message || err) });\n  }\n};\n"],
  "mappings": ";AAAA,IAAM,kBACJ,QAAQ,IAAI,qBAAqB;AAEnC,IAAM,OAAO,CAAC,YAAY,UAAU;AAAA,EAClC;AAAA,EACA,SAAS;AAAA,IACP,gBAAgB;AAAA,IAChB,+BAA+B;AAAA,IAC/B,gCAAgC;AAAA,IAChC,gCAAgC;AAAA,EAClC;AAAA,EACA,MAAM,KAAK,UAAU,IAAI;AAC3B;AAEA,QAAQ,UAAU,OAAO,UAAU;AACjC,MAAI;AACF,QAAI,MAAM,eAAe,UAAW,QAAO,KAAK,KAAK,CAAC,CAAC;AACvD,QAAI,MAAM,eAAe,MAAO,QAAO,KAAK,KAAK,EAAE,SAAS,qBAAqB,CAAC;AAElF,UAAM,QAAQ,MAAM,uBAAuB,SAAS;AACpD,QAAI,CAAC,MAAO,QAAO,KAAK,KAAK,EAAE,SAAS,wBAAwB,CAAC;AAEjE,UAAM,MAAM,IAAI,IAAI,eAAe;AACnC,QAAI,aAAa,IAAI,KAAK,KAAK;AAC/B,QAAI,aAAa,IAAI,UAAU,MAAM;AACrC,QAAI,aAAa,IAAI,SAAS,GAAG;AAEjC,UAAM,MAAM,MAAM,MAAM,IAAI,SAAS,GAAG;AAAA,MACtC,SAAS,EAAE,cAAc,2CAA2C;AAAA,IACtE,CAAC;AAED,QAAI,CAAC,IAAI,IAAI;AACX,YAAM,MAAM,MAAM,IAAI,KAAK;AAC3B,aAAO,KAAK,IAAI,QAAQ,EAAE,SAAS,kBAAkB,KAAK,IAAI,CAAC;AAAA,IACjE;AAEA,UAAM,MAAM,MAAM,IAAI,KAAK;AAC3B,QAAI,CAAC,MAAM,QAAQ,GAAG,KAAK,IAAI,WAAW,GAAG;AAC3C,aAAO,KAAK,KAAK,EAAE,SAAS,aAAa,MAAM,CAAC;AAAA,IAClD;AAEA,UAAM,QAAQ,IAAI,CAAC;AACnB,WAAO,KAAK,KAAK;AAAA,MACf,KAAK,OAAO,MAAM,GAAG;AAAA,MACrB,KAAK,OAAO,MAAM,GAAG;AAAA,MACrB,cAAc,MAAM;AAAA,MACpB,KAAK;AAAA,IACP,CAAC;AAAA,EACH,SAAS,KAAK;AACZ,WAAO,KAAK,KAAK,EAAE,SAAS,oBAAoB,OAAO,OAAO,KAAK,WAAW,GAAG,EAAE,CAAC;AAAA,EACtF;AACF;",
  "names": []
}
